$(function(){function d(t,e,i,n,s){var o;"Input"==i.render?(i=e.children("p.description:first"),o=e.children("p.notes:first"),e.html(s).prepend(i).append(o),t.hasClass("InputfieldImage")||t.hasClass("InputfieldFile")?(InputfieldImage($),t.trigger("reloaded"),e.prepend('<div class="version-control-overlay"></div>'),$(".version-control-overlay").attr("title",f.i18n.editDisabled).on("click",function(){alert($(this).attr("title"))}).hover(function(){$(this).parent(".version-control-overlay-parent").addClass("version-control-overlay-parent--hover")},function(){$(this).parent(".version-control-overlay-parent").removeClass("version-control-overlay-parent--hover")}).parent(".InputfieldContent").addClass("version-control-overlay-parent")):t.hasClass("Inputfield_permissions")&&($(".Inputfield_permissions .Inputfield_permissions > .InputfieldContent").insertAfter($(".Inputfield_permissions:first > .InputfieldContent:first")),$(".Inputfield_permissions:first > .InputfieldContent:first").remove()),t.find(".InputfieldAsmSelect").length&&(i=t.find("select[multiple=multiple]"),o="undefined"==typeof config?{sortable:!0}:config[i.attr("id")],i.asmSelect(o)),t.find(".langTabs").length&&"function"==typeof setupLanguageTabs&&setupLanguageTabs(t)):$.each(s,function(e,i){e=(e=e.replace("data",""))&&"__"+e;"undefined"!=typeof tinyMCE&&tinyMCE.get("Inputfield_"+n+e)?tinyMCE.get("Inputfield_"+n+e).setContent(i):t.find(".InputfieldCKEditorInline").length?t.find(".InputfieldCKEditorInline").html(i):"undefined"!=typeof CKEDITOR&&CKEDITOR.instances["Inputfield_"+n+e]&&CKEDITOR.instances["Inputfield_"+n+e].setData(i)})}function i(e,i){var t=$("#field-revisions--"+e);t.length&&(i=void 0===i?!t.attr("aria-hidden"):Boolean(i),$(".field-revisions-toggle[data-field="+e+"]").toggleClass("field-revisions-toggle--active",!i).attr("aria-expanded",!i),i?t.addClass("field-revisions--sliding").slideUp("fast",function(){t.removeClass("field-revisions--sliding").removeAttr("style").attr("aria-hidden",!0).find("a, button").attr("tabindex",-1),InputfieldColumnWidths()}):t.addClass("field-revisions--animatable field-revisions--sliding").slideDown("fast",function(){t.removeClass("field-revisions--sliding").removeAttr("aria-hidden").focus().find("a, button").removeAttr("tabindex"),InputfieldColumnWidths()}),$(window).trigger("resize.revisions-table"))}var f=config.VersionControl,c={},o=$('<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>'),r=(window.versionControlPrepareInputfields=function(){var e;$("#version-control-data > div:not(.version-control--prepared)").each(function(){if($(this).data("revision")){var e=$(".Inputfield_"+$(this).data("field"));if(!e.length)return;if($(this).find("a, button").attr("tabindex",-1),$(this).find(".field-revision__current-label:first").attr("aria-hidden",!1),e.find("> label").addClass("version-control--with-history").data("version-control--field",$(this).data("field")).before($(this)),$(this).find("tr:eq(1)").addClass("ui-state-active"),e.hasClass("InputfieldTinyMCE")||e.hasClass("InputfieldCKEditor"))return;var i=e.find(".InputfieldContent:first")||e.find("div.ui-widget-content:first"),t=[],i=(e.hasClass("InputfieldImage")&&e.find(".ui-sortable").each(function(){t.push($(this).sortable("option")),$(this).sortable("destroy"),$(this).addClass("version-control--ui-sortable")}),i.clone(!0,!0));c[$(this).data("field")+"."+$(this).data("revision")]=i,e.find(".version-control--ui-sortable").each(function(){$(this).sortable(t.pop())})}$(this).addClass("version-control--prepared")}),$(".version-control--with-history:not(.version-control--prepared)").each(function(){var e=$("<a></a>").hide().appendTo($(this)).css("color"),e=$('<button><i class="fa fa-clock-o"></i></button>').addClass("field-revisions-toggle").attr("title",f.i18n.toggleRevisions).attr("aria-expanded",!1).attr("data-field",$(this).data("version-control--field")).prop("disabled",$("#field-revisions--"+$(this).data("version-control--field")).find("tr").length<2).css("color",e),i=($("<span></span>").addClass("version-control--visually-hidden").text(f.i18n.toggleRevisions).appendTo(e),$(this).find(".toggle-icon"));i.length?i.after(e):$(this).append(e),$(this).addClass("version-control--prepared")}),$(".field-revisions").off("click.revisions-restore").on("click.revisions-restore",".field-revision__button--restore, .field-revision__current",function(){var e=$(this).parents(".field-revision:first");if(e.hasClass("ui-state-active"))return!1;var i={render:"Input"},t=$(this).parents(".field-revisions:first"),n=e.find(".field-revision__current:first"),s=$(this).parents(".Inputfield:first"),o=t.data("field"),r=(s.find(".field-revisions .ui-state-active").removeClass("ui-state-active"),s.find(".field-revision__current-label").attr("aria-hidden",!0),e.addClass("ui-state-active"),n.find(".field-revision__current-label").attr("aria-hidden",!1),$(".compare-revisions").remove(),$(".field-revision__button--diff").removeClass("active"),s.find(".InputfieldContent:first")||s.find("div.ui-widget-content:first")),a=$('<span class="field-revision__loading"></span>').hide().css({height:r.innerHeight()+"px",backgroundColor:r.css("background-color")}),l=((s.hasClass("InputfieldTinyMCE")||s.hasClass("InputfieldCKEditor"))&&(i={render:"JSON"}),e.data("revision"));return c[o+"."+l]?"JSON"!=i.render&&l==t.data("revision")?(r.replaceWith(c[o+"."+l].clone(!0,!0)),s.find(".InputfieldFileList").length&&(s.find(".InputfieldFileInit").removeClass("InputfieldFileInit"),s.trigger("reloaded")),s.find(".InputfieldAsmSelect").length&&(n=s.find("select[multiple=multiple]"),e="undefined"==typeof config?{sortable:!0}:config[n.attr("id")],n.appendTo(s.find(".InputfieldAsmSelect")).show(),s.find(".asmContainer").remove(),n.asmSelect(e)),(s.hasClass("InputfieldImage")||s.hasClass("InputfieldFile"))&&(s.find(".InputfieldImageInitUpload").removeClass("InputfieldImageInitUpload"),s.removeClass("InputfieldImageInit"),s.trigger("reloaded"),InputfieldImage($))):d(s,r,i,o,c[o+"."+l]):(r.css("position","relative").prepend(a.fadeIn(250)),$.get(f.processPage+"field",{revision:l,field:o,settings:i},function(e){c[o+"."+l]=e,d(s,r,i,o,c[o+"."+l]),a.fadeOut(350,function(){$(this).remove()})})),!1}),$(".field-revisions-toggle").off("click.toggleRevisions").on("click.toggleRevisions",function(e){e.preventDefault(),i($(this).data("field"))}),$(window).off("keyup.field-revisions").on("keyup.field-revisions",function(e){"Esc"!=e.key&&"Escape"!=e.key||(e=$(document.activeElement)).hasClass("field-revisions")&&(e=e.data("field"),i(e),$(".field-revisions-toggle[data-field="+e+"]").focus())}),$(window).off("resize.revisions-table").on("resize.revisions-table",function(){clearTimeout(e),e=setTimeout(function(){$(".field-revisions:not(.field-revisions--animatable)").each(function(){$table=$(this).find("table"),$table.length&&$(this).width()<$table.outerWidth()?$(this).addClass("field-revisions--scrollable").find("> div").trigger("scroll.revisions-table"):$(this).removeClass("field-revisions--scrollable")})},250)}).trigger("resize.revisions-table"),$(".field-revisions > div").off("scroll.revisions-table").on("scroll.revisions-table",function(){$(this).parent().toggleClass("field-revisions--scrollable-start",!$(this).scrollLeft()).toggleClass("field-revisions--scrollable-end",$(this)[0].scrollWidth-$(this).scrollLeft()==$(this).outerWidth())}),$(".field-revisions").off("click.revisions-diff").on("click.revisions-diff",".field-revision__button--diff",function(){var e,i,t,n,s;return $(".compare-revisions").remove(),$(".field-revision__button--diff").not(this).removeClass("field-revisions__button--active"),$(this).toggleClass("field-revisions__button--active"),$(this).hasClass("field-revisions__button--active")&&($(this).attr("aria-expanded",!0),t=$(this).parents(".field-revisions:first"),i=$(this).parents(".field-revision:first"),e=t.data("field"),t=t.find(".ui-state-active:first").data("revision"),i=i.data("revision"),t=f.processPage+"diff/?revisions="+t+":"+i+"&field="+e,n=$("<div></div>").attr("tabindex",-1).addClass("compare-revisions").insertAfter($(this)).focus(),s=$(this).parents("tr:first"),n.prepend(o).load(t,function(){s.find("ul.page-diff").length?"function"!=typeof enableDiffSwitch?$.getScript(f.moduleDir+"diff_switch.min.js",function(){enableDiffSwitch(f)}):enableDiffSwitch(f):r();$("<button></button>").addClass("field-revision__button compare-revisions__close fa fas fa-times").attr("tabindex",0).on("click",function(e){e.preventDefault(),$(this).parent().prev().focus().trigger("click")}).prependTo(n)})),!1})},function(e,i){var t,e=e||document.getElementById("r1").value,i=i||document.getElementById("r2").value;if(e==i)t="<em>"+f.i18n.noDiff+"</em>";else{if("function"!=typeof diff_match_patch)return $.getScript(f.moduleDir+"res/js/diff_match_patch/diff_match_patch.js",function(){r(e,i)}),!1;var n=new diff_match_patch,s=(n.Diff_Timeout=f.diff.timeout,n.Diff_EditCost=f.diff.editCost,(new Date).getTime()),o=n.diff_main(e,i);(new Date).getTime();f.diff.cleanup&&n["diff_cleanup"+f.diff.cleanup](o),t=n.diff_prettyHtml(o)}document.getElementById("diff").innerHTML=t});$.get(f.processPage+"page",{pages_id:f.pageID,settings:{empty:!0,render:"HTML"}},function(e){$("body").prepend(e),versionControlPrepareInputfields(),$(document).on("reloaded",".Inputfield",function(){versionControlPrepareInputfields()})})});