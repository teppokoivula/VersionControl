$(function(){var i=config.VersionControl,e={};$.get(i.processPage+"page",{pages_id:i.pageID,settings:{empty:!0,render:"HTML"}},function(t){$("body").prepend(t);var n=$('<i class="fa fa-spinner fa-spin"></i>');$("#version-control-data > div").each(function(){if($(this).data("revision")){var i=$(".Inputfield_"+$(this).data("field"));if(i.find("> label").addClass("with-history").before($(this)),$(this).find("tr:eq(1)").addClass("ui-state-active"),i.hasClass("InputfieldTinyMCE")||i.hasClass("InputfieldCKEditor"))return;var t=i.find(".InputfieldContent")||i.find("div.ui-widget-content");e[$(this).data("field")+"."+$(this).data("revision")]=t.clone(!0,!0)}}),$(".ui-widget-header.with-history, .InputfieldHeader.with-history").each(function(){var i="field-revisions-toggle",e="";$(this).siblings(".field-revisions").find("tr").length<2&&(i+=" inactive",e=" title='"+$(this).siblings(".field-revisions").text()+"'");var t="<a "+e+'class="'+i+'"><i class="fa fa-clock-o"></i></a>';$(this).find(".toggle-icon").length?$(this).find(".toggle-icon").after(t):$(this).append(t)}),$(".field-revisions").on("click",".field-revision-restore, .field-revision-current",function(){var t=$(this).parents(".field-revision:first");if(t.hasClass("ui-state-active"))return!1;var n={render:"Input"},a=$(this).parents(".field-revisions:first"),f=$(this).parents(".Inputfield:first"),l=a.data("field");f.find(".field-revisions .ui-state-active").removeClass("ui-state-active"),t.addClass("ui-state-active"),$(".compare-revisions").remove(),$(".field-revision-diff").removeClass("active");var d=f.find(".InputfieldContent")||f.find("div.ui-widget-content"),r=$('<span class="field-revision-loading"></span>').hide().css({height:d.innerHeight()+"px",backgroundColor:d.css("background-color")});(f.hasClass("InputfieldTinyMCE")||f.hasClass("InputfieldCKEditor"))&&(n={render:"JSON"});var o=t.data("revision");if(e[l+"."+o])if("JSON"!=n.render&&o==a.data("revision")){if(d.replaceWith(e[l+"."+o].clone(!0,!0)),f.find(".InputfieldFileList").length&&(f.find(".InputfieldFileInit").removeClass("InputfieldFileInit"),f.trigger("reloaded")),f.find(".InputfieldAsmSelect").length){var c=f.find("select[multiple=multiple]"),p="undefined"==typeof config?{sortable:!0}:config[c.attr("id")];c.appendTo(f.find(".InputfieldAsmSelect")).show(),f.find(".asmContainer").remove(),c.asmSelect(p)}}else s(f,d,n,l,e[l+"."+o]);else d.css("position","relative").prepend(r.fadeIn(250)),$.get(i.processPage+"field",{revision:o,field:l,settings:n},function(i){e[l+"."+o]=i,s(f,d,n,l,e[l+"."+o]),r.fadeOut(350,function(){$(this).remove()})});return!1});var s=function(e,t,n,s,a){if("Input"==n.render){var f=t.children("p.description:first"),l=t.children("p.notes:first");if(t.html(a).prepend(f).append(l),e.hasClass("InputfieldImage")||e.hasClass("InputfieldFile")?(InputfieldImage($),t.prepend('<div class="version-control-overlay"></div>'),$(".version-control-overlay").attr("title",i.i18n.editDisabled).on("click",function(){alert($(this).attr("title"))}).hover(function(){$(this).parent(".overlay-parent").addClass("hover")},function(){$(this).parent(".overlay-parent").removeClass("hover")}).parent(".InputfieldContent").addClass("overlay-parent")):e.hasClass("Inputfield_permissions")&&($(".Inputfield_permissions .Inputfield_permissions > .InputfieldContent").insertAfter($(".Inputfield_permissions:first > .InputfieldContent:first")),$(".Inputfield_permissions:first > .InputfieldContent:first").remove()),e.find(".InputfieldAsmSelect").length){var d=e.find("select[multiple=multiple]"),r="undefined"==typeof config?{sortable:!0}:config[d.attr("id")];d.asmSelect(r)}}else $.each(a,function(i,t){var n=i.replace("data","");n&&(n="__"+n),"undefined"!=typeof tinyMCE&&tinyMCE.get("Inputfield_"+s+n)?tinyMCE.get("Inputfield_"+s+n).setContent(t):e.find(".InputfieldCKEditorInline").length?e.find(".InputfieldCKEditorInline").html(t):"undefined"!=typeof CKEDITOR&&CKEDITOR.instances["Inputfield_"+s+n]&&CKEDITOR.instances["Inputfield_"+s+n].setData(t)})};$(".field-revisions-toggle").on("click",function(){if($(this).hasClass("inactive"))return!1;var i=$(this).parent("label").siblings(".field-revisions");return i.is(":visible")?($(this).removeClass("active"),i.addClass("sliding").slideUp("fast",function(){i.removeClass("sliding"),InputfieldColumnWidths()})):($(this).addClass("active"),i.addClass("sliding").slideDown("fast",function(){if(i.removeClass("sliding"),InputfieldColumnWidths(),!i.hasClass("scroll-tip")&&i.width()<i.find("table").outerWidth()){var e=$('<div class="scroll-tip"><i class="fa fa-arrows-h" aria-hidden="true"></i></div>');i.prepend(e).addClass("scroll-tip"),window.setTimeout(function(){e.animate({left:"+=20px"},"slow",function(){$(this).animate({left:"-=20px"},"slow",function(){$(this).fadeOut(250)})})},250)}})),!1});var a=function(e,t){var n;e=e||document.getElementById("r1").value,t=t||document.getElementById("r2").value;if(e==t)n="<em>"+i.i18n.noDiff+"</em>";else{if("function"!=typeof diff_match_patch)return $.getScript(i.moduleDir+"diff_match_patch_20121119/javascript/diff_match_patch.js",function(){a(e,t)}),!1;var s=new diff_match_patch;s.Diff_Timeout=i.diff.timeout,s.Diff_EditCost=i.diff.editCost;var f=(new Date).getTime(),l=s.diff_main(e,t);(new Date).getTime();i.diff.cleanup&&s["diff_cleanup"+i.diff.cleanup](l),n=s.diff_prettyHtml(l)}document.getElementById("diff").innerHTML=n};$(".field-revisions").on("click",".field-revision-diff",function(){if($(".compare-revisions").remove(),$(".field-revision-diff").not(this).removeClass("active"),$(this).toggleClass("active"),$(this).hasClass("active")){var e=$(this).parents(".field-revisions:first"),t=$(this).parents(".field-revision:first"),s=e.data("field"),f=e.find(".ui-state-active:first").data("revision"),l=t.data("revision"),d=i.processPage+"diff/?revisions="+f+":"+l+"&field="+s,r=$('<div class="compare-revisions"></div>');$(this).before(r);var o=$(this).parents("tr:first");r.prepend(n).load(d,function(){o.find("ul.page-diff").length?"function"!=typeof enableDiffSwitch?$.getScript(i.moduleDir+"diff_switch.min.js",function(){enableDiffSwitch(i)}):enableDiffSwitch(i):a();$('<a class="compare-revisions-close fa fas fa-times"></a>').on("click",function(){$(this).parent().next().trigger("click")}).appendTo(r)})}return!1})})});
